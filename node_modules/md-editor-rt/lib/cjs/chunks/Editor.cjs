"use strict";var Wt=Object.defineProperty;var Zt=(e,n,s)=>n in e?Wt(e,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[n]=s;var ee=(e,n,s)=>(Zt(e,typeof n!="symbol"?n+"":n,s),s);const a=require("./jsx-runtime.cjs"),d=require("react"),v=require("./index.cjs"),r=require("./config.cjs"),V=require("./index2.cjs"),de=require("@vavt/util"),Yt=require("medium-zoom"),Jt=require("copy-to-clipboard"),Xt=require("markdown-it"),Qt=require("markdown-it-image-figures"),er=require("markdown-it-task-lists"),tr=require("lru-cache"),se=require("codemirror"),ue=require("@codemirror/view"),rr=require("@codemirror/language-data"),nr=require("@codemirror/lang-markdown"),pe=require("@codemirror/commands"),q=require("@codemirror/state"),fe=require("@codemirror/language"),h=require("@lezer/highlight"),lr=require("@codemirror/autocomplete"),me="onSave",ke="changeCatalogVisible",Ut="changeFullscreen",Tt="pageFullscreenChanged",jt="fullscreenChanged",St="previewChanged",Et="htmlPreviewChanged",Nt="catalogVisibleChanged",Kt="textareaFocus",or=(e,n)=>{const{modelValue:s}=e,{editorId:t}=n,[l,i]=d.useState({buildFinished:!1,html:""});d.useEffect(()=>{const u=o=>{i(()=>({buildFinished:!0,html:o}))};return v.bus.on(t,{name:"buildFinished",callback:u}),()=>{v.bus.remove(t,"buildFinished",u)}},[]),d.useEffect(()=>{const u=()=>{if(e.onSave){const o=new Promise(m=>{if(l.buildFinished)m(l.html);else{const g=c=>{m(c),v.bus.remove(t,"buildFinished",g)};v.bus.on(t,{name:"buildFinished",callback:g})}});e.onSave(e.modelValue,o)}};return v.bus.on(t,{name:me,callback:u}),()=>{v.bus.remove(t,me,u)}},[s,e,l.buildFinished,l.html]),d.useEffect(()=>{i(u=>({...u,buildFinished:!1}))},[s])},ir=e=>{var o,m,g,c,f,w;const{noPrettier:n,noUploadImg:s}=e,{editorExtensions:t}=r.configOption,l=n||!!((m=(o=r.configOption.editorExtensions)==null?void 0:o.prettier)!=null&&m.prettierInstance),i=n||!!((c=(g=r.configOption.editorExtensions)==null?void 0:g.prettier)!=null&&c.parserMarkdownInstance),u=s||!!((w=(f=r.configOption.editorExtensions)==null?void 0:f.cropper)!=null&&w.instance);d.useEffect(()=>{var x,C,y,S;const $=document.createElement("script"),k=document.createElement("script");$.src=((x=t==null?void 0:t.prettier)==null?void 0:x.standaloneJs)||r.prettierUrl.main,$.id=`${r.prefix}-prettier`,k.src=((C=t==null?void 0:t.prettier)==null?void 0:C.parserMarkdownJs)||r.prettierUrl.markdown,k.id=`${r.prefix}-prettierMD`;const b=document.createElement("link");b.rel="stylesheet",b.href=((y=t==null?void 0:t.cropper)==null?void 0:y.css)||r.cropperUrl.css,b.id=`${r.prefix}-cropperCss`;const p=document.createElement("script");p.src=((S=t==null?void 0:t.cropper)==null?void 0:S.js)||r.cropperUrl.js,p.id=`${r.prefix}-cropper`,u||(V.appendHandler(b),V.appendHandler(p)),l||V.appendHandler($),i||V.appendHandler(k)},[]),Gt(e)},Gt=({noIconfont:e})=>{d.useEffect(()=>{var s;const n=document.createElement("script");n.src=((s=r.configOption.editorExtensions)==null?void 0:s.iconfont)||r.iconfontUrl,n.id=`${r.prefix}-icon`,e||V.appendHandler(n)},[])},sr=(e,n)=>{d.useEffect(()=>(v.bus.on(e,{name:"errorCatcher",callback:n}),()=>{v.bus.remove(e,"errorCatcher",n)}),[n])},ar=(e,n)=>{const{editorId:s}=n;d.useEffect(()=>{const t=(l,i)=>{const u=o=>{v.bus.emit(s,"replace","image",{desc:"",urls:o}),i&&i()};e.onUploadImg&&e.onUploadImg(l,u)};return v.bus.on(s,{name:"uploadImage",callback:t}),()=>{v.bus.remove(s,"uploadImage",t)}},[e.onUploadImg])},cr=(e,n)=>{const{toolbars:s=r.allToolbar,toolbarsExclude:t=[]}=e,{editorId:l}=n,[i,u]=d.useState(!1);return d.useEffect(()=>{v.bus.on(l,{name:ke,callback:m=>{u(m===void 0?g=>!g:m)}})},[]),d.useMemo(()=>!t.includes("catalog")&&s.includes("catalog")&&i,[i,s,t])};let Mt="";const zt=e=>{const{theme:n=r.defaultProps.theme,preview:s=r.defaultProps.preview,htmlPreview:t=r.defaultProps.htmlPreview,pageFullscreen:l=r.defaultProps.pageFullscreen,previewTheme:i=r.defaultProps.previewTheme,codeTheme:u=r.defaultProps.codeTheme,language:o=r.defaultProps.language,codeStyleReverse:m=r.defaultProps.codeStyleReverse,codeStyleReverseList:g=r.defaultProps.codeStyleReverseList}=e,c=d.useMemo(()=>{var C,y;const b=(y=(C=r.configOption)==null?void 0:C.editorExtensions)==null?void 0:y.highlight,p={...r.codeCss,...b==null?void 0:b.css},x=m&&g.includes(i)?"dark":n;return{js:(b==null?void 0:b.js)||r.highlightUrl,css:p[u]?p[u][x]:r.codeCss.atom[x]}},[m,g,i,n,u]),f=d.useMemo(()=>{var p,x;const b={...r.staticTextDefault,...(x=(p=r.configOption)==null?void 0:p.editorConfig)==null?void 0:x.languageUserDefined};return b[o]?b[o]:r.staticTextDefault["zh-CN"]},[o]),[w,$]=d.useState({pageFullscreen:l,fullscreen:!1,preview:s,htmlPreview:s?!1:t}),k=d.useCallback((b,p)=>{$(x=>{const C={...x,[b]:p===void 0?!x[b]:p};return b==="fullscreen"&&(p||x.fullscreen?C.fullscreen=!x[b]:C.fullscreen=x[b]),b==="preview"&&C.preview?C.htmlPreview=!1:b==="htmlPreview"&&C.htmlPreview&&(C.preview=!1),C})},[]);return d.useEffect(()=>{Mt=document.body.style.overflow},[]),d.useEffect(()=>{w.pageFullscreen||w.fullscreen?document.body.style.overflow="hidden":document.body.style.overflow=Mt},[w.pageFullscreen,w.fullscreen]),[c,f,w,k]},dr=(e,n,s,t,l)=>{const{editorId:i}=n;d.useEffect(()=>{v.bus.emit(i,Tt,t.pageFullscreen)},[t.pageFullscreen]),d.useEffect(()=>{v.bus.emit(i,jt,t.fullscreen)},[t.fullscreen]),d.useEffect(()=>{v.bus.emit(i,St,t.preview)},[t.preview]),d.useEffect(()=>{v.bus.emit(i,Et,t.htmlPreview)},[t.htmlPreview]),d.useEffect(()=>{v.bus.emit(i,Nt,s)},[s]),d.useImperativeHandle(e,()=>({on(o,m){switch(o){case"pageFullscreen":{v.bus.on(i,{name:Tt,callback(g){m(g)}});break}case"fullscreen":{v.bus.on(i,{name:jt,callback(g){m(g)}});break}case"preview":{v.bus.on(i,{name:St,callback(g){m(g)}});break}case"htmlPreview":{v.bus.on(i,{name:Et,callback(g){m(g)}});break}case"catalog":{v.bus.on(i,{name:Nt,callback(g){m(g)}});break}}},togglePageFullscreen(o){l("pageFullscreen",o)},toggleFullscreen(o){v.bus.emit(i,Ut,o)},togglePreview(o){l("preview",o)},toggleHtmlPreview(o){l("htmlPreview",o)},toggleCatalog(o){v.bus.emit(i,ke,o)},triggerSave(){v.bus.emit(i,me)},insert(o){v.bus.emit(i,"replace","universal",{generate:o})},focus(o){v.bus.emit(i,Kt,o)}}),[l])},ur=()=>a.jsx("div",{className:`${r.prefix}-divider`}),Ht=`${r.prefix}-dropdown-hidden`,te=e=>{const[n,s]=d.useState({overlayClass:Ht,overlayStyle:{}}),t=d.useRef({triggerHover:!1,overlayHover:!1}),l=d.useRef(null),i=d.useRef(null),u=d.useCallback(()=>{var N;e.trigger==="hover"&&(t.current.triggerHover=!0);const b=l.current,p=i.current,x=b.getBoundingClientRect(),C=b.offsetTop,y=b.offsetLeft,S=x.height,j=x.width,T=((N=document.querySelector(e.relative))==null?void 0:N.scrollLeft)||0;s(H=>({...H,overlayStyle:{top:C+S+"px",left:y-p.offsetWidth/2+j/2-T+"px"}})),e.onChange(!0)},[e]),o=()=>{t.current.overlayHover=!0};d.useEffect(()=>{e.visible?s(b=>({...b,overlayClass:""})):s(b=>({...b,overlayClass:Ht}))},[e.visible]);const m=d.useCallback(b=>{const p=l.current,x=i.current;!p.contains(b.target)&&!x.contains(b.target)&&e.onChange(!1)},[e]),g=d.useRef(-1),c=d.useCallback(b=>{l.current===b.target?t.current.triggerHover=!1:t.current.overlayHover=!1,clearTimeout(g.current),g.current=window.setTimeout(()=>{!t.current.overlayHover&&!t.current.triggerHover&&e.onChange(!1)},10)},[e]);d.useEffect(()=>(e.trigger==="click"?(l.current.addEventListener("click",u),document.addEventListener("click",m)):(l.current.addEventListener("mouseenter",u),l.current.addEventListener("mouseleave",c),i.current.addEventListener("mouseenter",o),i.current.addEventListener("mouseleave",c)),()=>{e.trigger==="click"&&l.current?(l.current.removeEventListener("click",u),document.removeEventListener("click",m)):(l.current&&(l.current.removeEventListener("mouseenter",u),l.current.removeEventListener("mouseleave",c)),i.current&&(i.current.removeEventListener("mouseenter",o),i.current.removeEventListener("mouseleave",c)))}),[m,c,e.trigger,u]);const f=e.children,w=e.overlay,$=d.cloneElement(f,{ref:l}),k=a.jsx("div",{className:`${r.prefix}-dropdown ${n.overlayClass}`,style:n.overlayStyle,ref:i,children:a.jsx("div",{className:`${r.prefix}-dropdown-overlay`,children:w instanceof Array?w[0]:w})});return a.jsxs(a.Fragment,{children:[$,k]})};te.defaultProps={trigger:"hover",relative:"html"};const mr=e=>{var u,o,m,g,c;const{editorId:n,usedLanguageText:s}=d.useContext(P),t=d.useMemo(()=>{var f,w;switch(e.type){case"link":return(f=s.linkModalTips)==null?void 0:f.linkTitle;case"image":return(w=s.linkModalTips)==null?void 0:w.imageTitle;default:return""}},[e.type,s]),[l,i]=d.useState({desc:"",url:""});return d.useEffect(()=>{e.visible||setTimeout(()=>{i({desc:"",url:""})},200)},[e.visible]),d.useMemo(()=>{var f,w,$,k,b;return a.jsxs(V.Modal,{title:t,visible:e.visible,onClose:e.onCancel,children:[a.jsxs("div",{className:`${r.prefix}-form-item`,children:[a.jsx("label",{className:`${r.prefix}-label`,htmlFor:`link-desc-${n}`,children:(f=s.linkModalTips)==null?void 0:f.descLabel}),a.jsx("input",{placeholder:(w=s.linkModalTips)==null?void 0:w.descLabelPlaceHolder,className:`${r.prefix}-input`,id:`link-desc-${n}`,type:"text",value:l.desc,onChange:p=>{i(x=>({...x,desc:p.target.value}))}})]}),a.jsxs("div",{className:`${r.prefix}-form-item`,children:[a.jsx("label",{className:`${r.prefix}-label`,htmlFor:`link-url-${n}`,children:($=s.linkModalTips)==null?void 0:$.urlLabel}),a.jsx("input",{placeholder:(k=s.linkModalTips)==null?void 0:k.urlLabelPlaceHolder,className:`${r.prefix}-input`,id:`link-url-${n}`,type:"text",value:l.url,onChange:p=>{i(x=>({...x,url:p.target.value}))}})]}),a.jsx("div",{className:`${r.prefix}-form-item`,children:a.jsx("button",{className:`${r.prefix}-btn ${r.prefix}-btn-row`,type:"button",onClick:()=>{e.onOk(l),i(p=>({...p,desc:"",url:""}))},children:(b=s.linkModalTips)==null?void 0:b.buttonOK})})]})},[t,e,(u=s.linkModalTips)==null?void 0:u.descLabel,(o=s.linkModalTips)==null?void 0:o.descLabelPlaceHolder,(m=s.linkModalTips)==null?void 0:m.urlLabel,(g=s.linkModalTips)==null?void 0:g.urlLabelPlaceHolder,(c=s.linkModalTips)==null?void 0:c.buttonOK,l])},fr=mr;let Z=null;const gr=e=>{var $,k,b,p;const n=d.useContext(P),{editorId:s,usedLanguageText:t}=n,l=(k=($=r.configOption.editorExtensions)==null?void 0:$.cropper)==null?void 0:k.instance,i=d.useRef(null),u=d.useRef(null),o=d.useRef(null),[m,g]=d.useState({cropperInited:!1,imgSelected:!1,imgSrc:"",isFullscreen:!1});d.useEffect(()=>{e.visible&&!m.cropperInited&&(window.Cropper=l||window.Cropper,i.current.onchange=()=>{if(!window.Cropper){v.bus.emit(s,"errorCatcher",{name:"Cropper",message:"Cropper is undefined"});return}const x=i.current.files||[];if((x==null?void 0:x.length)>0){const C=new FileReader;C.onload=y=>{g(S=>({...S,imgSelected:!0,imgSrc:y.target.result}))},C.readAsDataURL(x[0])}})},[e.visible,m.cropperInited]),d.useEffect(()=>{m.imgSrc&&(Z=new window.Cropper(u.current,{viewMode:2,preview:`.${r.prefix}-clip-preview-target`}))},[m.imgSrc]),d.useEffect(()=>{var x;(x=o.current)==null||x.setAttribute("style","")},[m.imgSelected]),d.useEffect(()=>{var x;Z==null||Z.destroy(),(x=o.current)==null||x.setAttribute("style",""),u.current&&(Z=new window.Cropper(u.current,{viewMode:2,preview:`.${r.prefix}-clip-preview-target`}))},[m.isFullscreen]);const c=d.useMemo(()=>m.isFullscreen?{width:"100%",height:"100%"}:{width:"668px",height:"392px"},[m.isFullscreen]),f=()=>{Z.clear(),Z.destroy(),Z=null,i.current.value="",g(x=>({...x,imgSrc:"",imgSelected:!1}))},w=d.useCallback(x=>{g(C=>({...C,isFullscreen:x}))},[]);return d.useMemo(()=>{var x,C;return a.jsxs(V.Modal,{className:`${r.prefix}-modal-clip`,title:(x=t.clipModalTips)==null?void 0:x.title,visible:e.visible,onClose:e.onCancel,showAdjust:!0,isFullscreen:m.isFullscreen,onAdjust:w,...c,children:[a.jsxs("div",{className:`${r.prefix}-form-item ${r.prefix}-clip`,children:[a.jsx("div",{className:`${r.prefix}-clip-main`,children:m.imgSelected?a.jsxs("div",{className:`${r.prefix}-clip-cropper`,children:[a.jsx("img",{src:m.imgSrc,ref:u,style:{display:"none"},alt:""}),a.jsx("div",{className:`${r.prefix}-clip-delete`,onClick:f,children:a.jsx("svg",{className:`${r.prefix}-icon`,"aria-hidden":"true",children:a.jsx("use",{xlinkHref:"#md-editor-icon-delete"})})})]}):a.jsx("div",{className:`${r.prefix}-clip-upload`,onClick:()=>{i.current.click()},children:a.jsx("svg",{className:`${r.prefix}-icon`,"aria-hidden":"true",children:a.jsx("use",{xlinkHref:"#md-editor-icon-upload"})})})}),a.jsx("div",{className:`${r.prefix}-clip-preview`,children:a.jsx("div",{className:`${r.prefix}-clip-preview-target`,ref:o})})]}),a.jsx("div",{className:`${r.prefix}-form-item`,children:a.jsx("button",{className:`${r.prefix}-btn`,type:"button",onClick:()=>{if(Z){const y=Z.getCroppedCanvas();v.bus.emit(s,"uploadImage",[v.base642File(y.toDataURL("image/png"))],e.onOk),f()}},children:(C=t.linkModalTips)==null?void 0:C.buttonOK})}),a.jsx("input",{ref:i,accept:"image/*",type:"file",multiple:!1,style:{display:"none"}})]})},[(b=t.clipModalTips)==null?void 0:b.title,(p=t.linkModalTips)==null?void 0:p.buttonOK,e.visible,e.onCancel,e.onOk,m.isFullscreen,m.imgSelected,m.imgSrc,w,c])},hr=gr,pr=e=>a.jsxs(a.Fragment,{children:[a.jsx(fr,{type:e.type,visible:e.linkVisible,onOk:e.onOk,onCancel:e.onCancel}),a.jsx(hr,{visible:e.clipVisible,onOk:e.onOk,onCancel:e.onCancel})]}),br=pr,xr=e=>{const[n,s]=d.useState({x:-1,y:-1});return a.jsx("div",{className:`${r.prefix}-table-shape`,onMouseLeave:()=>{s({x:-1,y:-1})},children:new Array(e.tableShape[1]).fill("").map((t,l)=>a.jsx("div",{className:`${r.prefix}-table-shape-row`,children:new Array(e.tableShape[0]).fill("").map((i,u)=>a.jsx("div",{className:`${r.prefix}-table-shape-col`,onMouseEnter:()=>{s({x:l,y:u})},onClick:()=>{e.onSelected(n)},children:a.jsx("div",{className:[`${r.prefix}-table-shape-col-default`,l<=n.x&&u<=n.y&&`${r.prefix}-table-shape-col-include`].filter(o=>!!o).join(" ")})},`table-shape-col-${u}`))},`table-shape-row-${l}`))})},kr=xr,vr=e=>{var u;const{editorId:n}=d.useContext(P),s=(u=r.configOption.editorExtensions)==null?void 0:u.screenfull;let t=s==null?void 0:s.instance;const l=d.useRef(!1),i=d.useCallback(o=>{if(!t){v.bus.emit(n,"errorCatcher",{name:"fullscreen",message:"fullscreen is undefined"});return}t.isEnabled?(l.current=!0,(o===void 0?!t.isFullscreen:o)?t.request():t.exit()):console.error("browser does not support screenfull!")},[]);return d.useEffect(()=>{let o;t||(o=document.createElement("script"),o.src=(s==null?void 0:s.js)||r.screenfullUrl,o.onload=()=>{t=window.screenfull,t&&t.isEnabled&&t.on("change",()=>{e.updateSetting("fullscreen",l.current),l.current&&(l.current=!1)})},o.id=`${r.prefix}-screenfull`,V.appendHandler(o,"screenfull")),t&&t.isEnabled&&t.on("change",()=>{e.updateSetting("fullscreen",l.current),l.current&&(l.current=!1)})},[]),d.useEffect(()=>{v.bus.on(n,{name:Ut,callback:i})},[]),{fullscreenHandler:i}},Cr=(e,n)=>{const{editorId:s}=d.useContext(P),[t,l]=d.useState({type:"link",linkVisible:!1,clipVisible:!1}),i=d.useCallback(()=>{l(o=>({...o,linkVisible:!1,clipVisible:!1}))},[]),u=d.useCallback(o=>{o&&n(t.type,{desc:o.desc,url:o.url}),i()},[n,t.type,i]);return d.useEffect(()=>{v.bus.on(s,{name:"openModals",callback(m){l(g=>({...g,type:m,linkVisible:!0}))}});const o=()=>{v.bus.emit(s,"uploadImage",Array.from(e.current.files||[])),e.current.value=""};e.current.addEventListener("change",o)},[]),{modalData:t,setModalData:l,onCancel:i,onOk:u}},$r=e=>{const[n,s]=d.useState({title:!1,catalog:!1,image:!1,table:!1,mermaid:!1,katex:!1}),t=d.useCallback($=>{s(k=>({...k,title:$}))},[]),l=d.useCallback(()=>{s($=>({...$,title:!1}))},[]),i=d.useCallback($=>{s(k=>({...k,image:$}))},[]),u=d.useCallback(()=>{s($=>({...$,image:!1}))},[]),o=d.useCallback($=>{s(k=>({...k,table:$}))},[]),m=d.useCallback($=>{e("table",{selectedShape:$})},[e]),g=d.useCallback($=>{s(k=>({...k,mermaid:$}))},[]),c=d.useCallback(()=>{s($=>({...$,mermaid:!1}))},[]),f=d.useCallback($=>{s(k=>({...k,katex:$}))},[]),w=d.useCallback(()=>{s($=>({...$,katex:!1}))},[]);return{visible:n,onTitleChange:t,onTitleClose:l,onImageChange:i,onImageClose:u,onTableChange:o,onTableSelected:m,onMermaidChange:g,onMermaidClose:c,onKatexChange:f,onKatexClose:w}};let wr=0;const yr=e=>{var z,K,W,F,_,le,ge,Ce,$e,we,ye,Te,je,Se,Ee,Ne,Me,He,Le,Ie,Pe,Ae,Re,De,Oe,Fe,_e,qe,Ve,Be,Ue,Ke,Ge,ze,We,Ze,Ye,Je,Xe,Qe,et,tt,rt,nt,lt,ot,it,st;const{toolbars:n,toolbarsExclude:s,setting:t,updateSetting:l}=e,{editorId:i,usedLanguageText:u}=d.useContext(P),o=u,[m]=d.useState(()=>`${i}-toolbar-wrapper`),g=d.useRef(null),c=d.useCallback((M,I)=>{v.bus.emit(i,"replace",M,I)},[]),{fullscreenHandler:f}=vr(e),{modalData:w,setModalData:$,onCancel:k,onOk:b}=Cr(g,c),{visible:p,onTitleChange:x,onTitleClose:C,onImageChange:y,onImageClose:S,onTableChange:j,onTableSelected:T,onMermaidChange:N,onMermaidClose:H,onKatexChange:L,onKatexClose:D}=$r(c),O=d.useMemo(()=>{var M,I,R,B,A,X,Q;return a.jsx(te,{relative:`#${m}`,visible:p.title,onChange:x,overlay:a.jsxs("ul",{className:`${r.prefix}-menu`,onClick:C,children:[a.jsx("li",{className:`${r.prefix}-menu-item`,onClick:()=>{c("h1")},children:(M=o.titleItem)==null?void 0:M.h1}),a.jsx("li",{className:`${r.prefix}-menu-item`,onClick:()=>{c("h2")},children:(I=o.titleItem)==null?void 0:I.h2}),a.jsx("li",{className:`${r.prefix}-menu-item`,onClick:()=>{c("h3")},children:(R=o.titleItem)==null?void 0:R.h3}),a.jsx("li",{className:`${r.prefix}-menu-item`,onClick:()=>{c("h4")},children:(B=o.titleItem)==null?void 0:B.h4}),a.jsx("li",{className:`${r.prefix}-menu-item`,onClick:()=>{c("h5")},children:(A=o.titleItem)==null?void 0:A.h5}),a.jsx("li",{className:`${r.prefix}-menu-item`,onClick:()=>{c("h6")},children:(X=o.titleItem)==null?void 0:X.h6})]}),children:a.jsx("div",{className:`${r.prefix}-toolbar-item`,title:(Q=o.toolbarTips)==null?void 0:Q.title,children:a.jsx("svg",{className:`${r.prefix}-icon`,"aria-hidden":"true",children:a.jsx("use",{xlinkHref:"#md-editor-icon-title"})})})},"bar-title")},[m,p.title,x,C,(z=o.titleItem)==null?void 0:z.h1,(K=o.titleItem)==null?void 0:K.h2,(W=o.titleItem)==null?void 0:W.h3,(F=o.titleItem)==null?void 0:F.h4,(_=o.titleItem)==null?void 0:_.h5,(le=o.titleItem)==null?void 0:le.h6,(ge=o.toolbarTips)==null?void 0:ge.title,c]),E=d.useMemo(()=>{var M,I,R,B;return a.jsx(te,{relative:`#${m}`,visible:p.image,onChange:y,overlay:a.jsxs("ul",{className:`${r.prefix}-menu`,onClick:S,children:[a.jsx("li",{className:`${r.prefix}-menu-item`,onClick:()=>{$(A=>({...A,type:"image",linkVisible:!0}))},children:(M=o.imgTitleItem)==null?void 0:M.link}),a.jsx("li",{className:`${r.prefix}-menu-item`,onClick:()=>{g.current.click()},children:(I=o.imgTitleItem)==null?void 0:I.upload}),a.jsx("li",{className:`${r.prefix}-menu-item`,onClick:()=>{$(A=>({...A,type:"image",clipVisible:!0}))},children:(R=o.imgTitleItem)==null?void 0:R.clip2upload})]}),children:a.jsx("div",{className:`${r.prefix}-toolbar-item`,title:(B=o.toolbarTips)==null?void 0:B.image,children:a.jsx("svg",{className:`${r.prefix}-icon`,"aria-hidden":"true",children:a.jsx("use",{xlinkHref:"#md-editor-icon-image"})})})},"bar-image")},[m,p.image,y,S,(Ce=o.imgTitleItem)==null?void 0:Ce.link,($e=o.imgTitleItem)==null?void 0:$e.upload,(we=o.imgTitleItem)==null?void 0:we.clip2upload,(ye=o.toolbarTips)==null?void 0:ye.image,$]),G=d.useMemo(()=>{var M;return a.jsx(te,{relative:`#${m}`,visible:p.table,onChange:j,overlay:a.jsx(kr,{tableShape:e.tableShape,onSelected:T}),children:a.jsx("div",{className:`${r.prefix}-toolbar-item`,title:(M=o.toolbarTips)==null?void 0:M.table,children:a.jsx("svg",{className:`${r.prefix}-icon`,"aria-hidden":"true",children:a.jsx("use",{xlinkHref:"#md-editor-icon-table"})})})},"bar-table")},[m,p.table,j,e.tableShape,T,(Te=o.toolbarTips)==null?void 0:Te.table]),U=d.useMemo(()=>{var M,I,R,B,A,X,Q,oe,ie;return a.jsx(te,{relative:`#${m}`,visible:p.mermaid,onChange:N,overlay:a.jsxs("ul",{className:`${r.prefix}-menu`,onClick:H,children:[a.jsx("li",{className:`${r.prefix}-menu-item`,onClick:()=>{c("flow")},children:(M=o.mermaid)==null?void 0:M.flow}),a.jsx("li",{className:`${r.prefix}-menu-item`,onClick:()=>{c("sequence")},children:(I=o.mermaid)==null?void 0:I.sequence}),a.jsx("li",{className:`${r.prefix}-menu-item`,onClick:()=>{c("gantt")},children:(R=o.mermaid)==null?void 0:R.gantt}),a.jsx("li",{className:`${r.prefix}-menu-item`,onClick:()=>{c("class")},children:(B=o.mermaid)==null?void 0:B.class}),a.jsx("li",{className:`${r.prefix}-menu-item`,onClick:()=>{c("state")},children:(A=o.mermaid)==null?void 0:A.state}),a.jsx("li",{className:`${r.prefix}-menu-item`,onClick:()=>{c("pie")},children:(X=o.mermaid)==null?void 0:X.pie}),a.jsx("li",{className:`${r.prefix}-menu-item`,onClick:()=>{c("relationship")},children:(Q=o.mermaid)==null?void 0:Q.relationship}),a.jsx("li",{className:`${r.prefix}-menu-item`,onClick:()=>{c("journey")},children:(oe=o.mermaid)==null?void 0:oe.journey})]}),children:a.jsx("div",{className:`${r.prefix}-toolbar-item`,title:(ie=o.toolbarTips)==null?void 0:ie.mermaid,children:a.jsx("svg",{className:`${r.prefix}-icon`,"aria-hidden":"true",children:a.jsx("use",{xlinkHref:"#md-editor-icon-mermaid"})})})},"bar-mermaid")},[m,p.mermaid,N,H,(je=o.mermaid)==null?void 0:je.flow,(Se=o.mermaid)==null?void 0:Se.sequence,(Ee=o.mermaid)==null?void 0:Ee.gantt,(Ne=o.mermaid)==null?void 0:Ne.class,(Me=o.mermaid)==null?void 0:Me.state,(He=o.mermaid)==null?void 0:He.pie,(Le=o.mermaid)==null?void 0:Le.relationship,(Ie=o.mermaid)==null?void 0:Ie.journey,(Pe=o.toolbarTips)==null?void 0:Pe.mermaid,c]),re=d.useMemo(()=>{var M,I,R;return a.jsx(te,{relative:`#${m}`,visible:p.katex,onChange:L,overlay:a.jsxs("ul",{className:`${r.prefix}-menu`,onClick:D,children:[a.jsx("li",{className:`${r.prefix}-menu-item`,onClick:()=>{c("katexInline")},children:(M=o.katex)==null?void 0:M.inline}),a.jsx("li",{className:`${r.prefix}-menu-item`,onClick:()=>{c("katexBlock")},children:(I=o.katex)==null?void 0:I.block})]}),children:a.jsx("div",{className:`${r.prefix}-toolbar-item`,title:(R=o.toolbarTips)==null?void 0:R.katex,children:a.jsx("svg",{className:`${r.prefix}-icon`,"aria-hidden":"true",children:a.jsx("use",{xlinkHref:"#md-editor-icon-formula"})})})},"bar-katex")},[m,p.katex,L,D,(Ae=o.katex)==null?void 0:Ae.inline,(Re=o.katex)==null?void 0:Re.block,(De=o.toolbarTips)==null?void 0:De.katex,c]),Y=d.useCallback(M=>{var I,R,B,A,X,Q,oe,ie,at,ct,dt,ut,mt,ft,gt,ht,pt,bt,xt,kt,vt,Ct,$t,wt;if(r.allToolbar.includes(M))switch(M){case"-":return a.jsx(ur,{},`bar-${wr++}`);case"bold":return a.jsx("div",{className:`${r.prefix}-toolbar-item`,title:(I=o.toolbarTips)==null?void 0:I.bold,onClick:()=>{c("bold")},children:a.jsx("svg",{className:`${r.prefix}-icon`,"aria-hidden":"true",children:a.jsx("use",{xlinkHref:"#md-editor-icon-bold"})})},"bar-bold");case"underline":return a.jsx("div",{className:`${r.prefix}-toolbar-item`,title:(R=o.toolbarTips)==null?void 0:R.underline,onClick:()=>{c("underline")},children:a.jsx("svg",{className:`${r.prefix}-icon`,"aria-hidden":"true",children:a.jsx("use",{xlinkHref:"#md-editor-icon-underline"})})},"bar-underline");case"italic":return a.jsx("div",{className:`${r.prefix}-toolbar-item`,title:(B=o.toolbarTips)==null?void 0:B.italic,onClick:()=>{c("italic")},children:a.jsx("svg",{className:`${r.prefix}-icon`,"aria-hidden":"true",children:a.jsx("use",{xlinkHref:"#md-editor-icon-italic"})})},"bar-italic");case"strikeThrough":return a.jsx("div",{className:`${r.prefix}-toolbar-item`,title:(A=o.toolbarTips)==null?void 0:A.strikeThrough,onClick:()=>{c("strikeThrough")},children:a.jsx("svg",{className:`${r.prefix}-icon`,"aria-hidden":"true",children:a.jsx("use",{xlinkHref:"#md-editor-icon-strike-through"})})},"bar-strikeThrough");case"title":return O;case"sub":return a.jsx("div",{className:`${r.prefix}-toolbar-item`,title:(X=o.toolbarTips)==null?void 0:X.sub,onClick:()=>{c("sub")},children:a.jsx("svg",{className:`${r.prefix}-icon`,"aria-hidden":"true",children:a.jsx("use",{xlinkHref:"#md-editor-icon-sub"})})},"bar-sub");case"sup":return a.jsx("div",{className:`${r.prefix}-toolbar-item`,title:(Q=o.toolbarTips)==null?void 0:Q.sup,onClick:()=>{c("sup")},children:a.jsx("svg",{className:`${r.prefix}-icon`,"aria-hidden":"true",children:a.jsx("use",{xlinkHref:"#md-editor-icon-sup"})})},"bar-sup");case"quote":return a.jsx("div",{className:`${r.prefix}-toolbar-item`,title:(oe=o.toolbarTips)==null?void 0:oe.quote,onClick:()=>{c("quote")},children:a.jsx("svg",{className:`${r.prefix}-icon`,"aria-hidden":"true",children:a.jsx("use",{xlinkHref:"#md-editor-icon-quote"})})},"bar-quote");case"unorderedList":return a.jsx("div",{className:`${r.prefix}-toolbar-item`,title:(ie=o.toolbarTips)==null?void 0:ie.unorderedList,onClick:()=>{c("unorderedList")},children:a.jsx("svg",{className:`${r.prefix}-icon`,"aria-hidden":"true",children:a.jsx("use",{xlinkHref:"#md-editor-icon-unordered-list"})})},"bar-unorderedList");case"orderedList":return a.jsx("div",{className:`${r.prefix}-toolbar-item`,title:(at=o.toolbarTips)==null?void 0:at.orderedList,onClick:()=>{c("orderedList")},children:a.jsx("svg",{className:`${r.prefix}-icon`,"aria-hidden":"true",children:a.jsx("use",{xlinkHref:"#md-editor-icon-ordered-list"})})},"bar-orderedList");case"task":return a.jsx("div",{className:`${r.prefix}-toolbar-item`,title:(ct=o.toolbarTips)==null?void 0:ct.task,onClick:()=>{c("task")},children:a.jsx("svg",{className:`${r.prefix}-icon`,"aria-hidden":"true",children:a.jsx("use",{xlinkHref:"#md-editor-icon-task"})})},"bar-task");case"codeRow":return a.jsx("div",{className:`${r.prefix}-toolbar-item`,title:(dt=o.toolbarTips)==null?void 0:dt.codeRow,onClick:()=>{c("codeRow")},children:a.jsx("svg",{className:`${r.prefix}-icon`,"aria-hidden":"true",children:a.jsx("use",{xlinkHref:"#md-editor-icon-code-row"})})},"bar-codeRow");case"code":return a.jsx("div",{className:`${r.prefix}-toolbar-item`,title:(ut=o.toolbarTips)==null?void 0:ut.code,onClick:()=>{c("code")},children:a.jsx("svg",{className:`${r.prefix}-icon`,"aria-hidden":"true",children:a.jsx("use",{xlinkHref:"#md-editor-icon-code"})})},"bar-code");case"link":return a.jsx("div",{className:`${r.prefix}-toolbar-item`,title:(mt=o.toolbarTips)==null?void 0:mt.link,onClick:()=>{$({...w,type:"link",linkVisible:!0})},children:a.jsx("svg",{className:`${r.prefix}-icon`,"aria-hidden":"true",children:a.jsx("use",{xlinkHref:"#md-editor-icon-link"})})},"bar-link");case"image":return e.noUploadImg?a.jsx("div",{className:`${r.prefix}-toolbar-item`,title:(ft=o.toolbarTips)==null?void 0:ft.image,onClick:()=>{$(yt=>({...yt,type:"image",linkVisible:!0}))},children:a.jsx("svg",{className:`${r.prefix}-icon`,"aria-hidden":"true",children:a.jsx("use",{xlinkHref:"#md-editor-icon-image"})})},"bar-image-no-upload"):E;case"table":return G;case"revoke":return a.jsx("div",{className:`${r.prefix}-toolbar-item`,title:(gt=o.toolbarTips)==null?void 0:gt.revoke,onClick:()=>{v.bus.emit(i,"ctrlZ")},children:a.jsx("svg",{className:`${r.prefix}-icon`,"aria-hidden":"true",children:a.jsx("use",{xlinkHref:"#md-editor-icon-revoke"})})},"bar-revoke");case"next":return a.jsx("div",{className:`${r.prefix}-toolbar-item`,title:(ht=o.toolbarTips)==null?void 0:ht.next,onClick:()=>{v.bus.emit(i,"ctrlShiftZ")},children:a.jsx("svg",{className:`${r.prefix}-icon`,"aria-hidden":"true",children:a.jsx("use",{xlinkHref:"#md-editor-icon-next"})})},"bar-next");case"save":return a.jsx("div",{className:`${r.prefix}-toolbar-item`,title:(pt=o.toolbarTips)==null?void 0:pt.save,onClick:()=>{v.bus.emit(i,me)},children:a.jsx("svg",{className:`${r.prefix}-icon`,"aria-hidden":"true",children:a.jsx("use",{xlinkHref:"#md-editor-icon-baocun"})})},"bar-save");case"prettier":return e.noPrettier?"":a.jsx("div",{className:`${r.prefix}-toolbar-item`,title:(bt=o.toolbarTips)==null?void 0:bt.prettier,onClick:()=>{c("prettier")},children:a.jsx("svg",{className:`${r.prefix}-icon`,"aria-hidden":"true",children:a.jsx("use",{xlinkHref:"#md-editor-icon-prettier"})})},"bar-prettier");case"pageFullscreen":return!t.fullscreen&&a.jsx("div",{className:`${r.prefix}-toolbar-item`,title:(xt=o.toolbarTips)==null?void 0:xt.pageFullscreen,onClick:()=>{l("pageFullscreen")},children:a.jsx("svg",{className:`${r.prefix}-icon`,"aria-hidden":"true",children:a.jsx("use",{xlinkHref:`#md-editor-icon-${t.pageFullscreen?"suoxiao":"fangda"}`})})},"bar-pageFullscreen");case"fullscreen":return a.jsx("div",{className:`${r.prefix}-toolbar-item`,title:(kt=o.toolbarTips)==null?void 0:kt.fullscreen,onClick:()=>{f()},children:a.jsx("svg",{className:`${r.prefix}-icon`,"aria-hidden":"true",children:a.jsx("use",{xlinkHref:`#md-editor-icon-${t.fullscreen?"fullscreen-exit":"fullscreen"}`})})},"bar-fullscreen");case"catalog":return a.jsx("div",{className:`${r.prefix}-toolbar-item`,title:(vt=o.toolbarTips)==null?void 0:vt.catalog,onClick:()=>{v.bus.emit(i,ke)},children:a.jsx("svg",{className:`${r.prefix}-icon`,"aria-hidden":"true",children:a.jsx("use",{xlinkHref:"#md-editor-icon-catalog"})})},"bar-catalog");case"preview":return a.jsx("div",{className:`${r.prefix}-toolbar-item`,title:(Ct=o.toolbarTips)==null?void 0:Ct.preview,onClick:()=>{l("preview")},children:a.jsx("svg",{className:`${r.prefix}-icon`,"aria-hidden":"true",children:a.jsx("use",{xlinkHref:"#md-editor-icon-preview"})})},"bar-preview");case"htmlPreview":return a.jsx("div",{className:`${r.prefix}-toolbar-item`,title:($t=o.toolbarTips)==null?void 0:$t.htmlPreview,onClick:()=>{l("htmlPreview")},children:a.jsx("svg",{className:`${r.prefix}-icon`,"aria-hidden":"true",children:a.jsx("use",{xlinkHref:"#md-editor-icon-coding"})})},"bar-htmlPreview");case"github":return a.jsx("div",{className:`${r.prefix}-toolbar-item`,title:(wt=o.toolbarTips)==null?void 0:wt.github,onClick:()=>de.linkTo("https://github.com/imzbf/md-editor-rt"),children:a.jsx("svg",{className:`${r.prefix}-icon`,"aria-hidden":"true",children:a.jsx("use",{xlinkHref:"#md-editor-icon-github"})})},"bar-github");case"mermaid":return U;case"katex":return re}else return e.defToolbars&&e.defToolbars[M]||""},[e.defToolbars,e.noUploadImg,e.noPrettier,(Oe=o.toolbarTips)==null?void 0:Oe.bold,(Fe=o.toolbarTips)==null?void 0:Fe.underline,(_e=o.toolbarTips)==null?void 0:_e.italic,(qe=o.toolbarTips)==null?void 0:qe.strikeThrough,(Ve=o.toolbarTips)==null?void 0:Ve.sub,(Be=o.toolbarTips)==null?void 0:Be.sup,(Ue=o.toolbarTips)==null?void 0:Ue.quote,(Ke=o.toolbarTips)==null?void 0:Ke.unorderedList,(Ge=o.toolbarTips)==null?void 0:Ge.orderedList,(ze=o.toolbarTips)==null?void 0:ze.task,(We=o.toolbarTips)==null?void 0:We.codeRow,(Ze=o.toolbarTips)==null?void 0:Ze.code,(Ye=o.toolbarTips)==null?void 0:Ye.link,(Je=o.toolbarTips)==null?void 0:Je.image,(Xe=o.toolbarTips)==null?void 0:Xe.revoke,(Qe=o.toolbarTips)==null?void 0:Qe.next,(et=o.toolbarTips)==null?void 0:et.save,(tt=o.toolbarTips)==null?void 0:tt.prettier,(rt=o.toolbarTips)==null?void 0:rt.pageFullscreen,(nt=o.toolbarTips)==null?void 0:nt.fullscreen,(lt=o.toolbarTips)==null?void 0:lt.catalog,(ot=o.toolbarTips)==null?void 0:ot.preview,(it=o.toolbarTips)==null?void 0:it.htmlPreview,(st=o.toolbarTips)==null?void 0:st.github,c,O,$,w,E,G,i,t.fullscreen,t.pageFullscreen,l,f,U,re]),J=d.useMemo(()=>{const M=n.filter(A=>!s.includes(A)),I=M.indexOf("="),R=I===-1?M:M.slice(0,I+1),B=I===-1?[]:M.slice(I,Number.MAX_SAFE_INTEGER);return[R.map(A=>Y(A)),B.map(A=>Y(A))]},[n,s,Y]);return a.jsxs(a.Fragment,{children:[n.length>0&&a.jsx("div",{className:`${r.prefix}-toolbar-wrapper`,id:m,children:a.jsxs("div",{className:`${r.prefix}-toolbar`,children:[a.jsx("div",{className:`${r.prefix}-toolbar-left`,children:J[0]}),a.jsx("div",{className:`${r.prefix}-toolbar-right`,children:J[1]})]})}),a.jsx("input",{ref:g,accept:"image/*",type:"file",multiple:!0,style:{display:"none"}}),a.jsx(br,{linkVisible:w.linkVisible,clipVisible:w.clipVisible,type:w.type,onCancel:k,onOk:b})]})},Tr=d.memo(yr),jr=(e,n)=>{const s=de.debounce(()=>{e.removeEventListener("scroll",t),e.addEventListener("scroll",t),n.removeEventListener("scroll",t),n.addEventListener("scroll",t)},50),t=l=>{const i=e.clientHeight,u=n.clientHeight,o=e.scrollHeight,m=n.scrollHeight,g=(o-i)/(m-u);l.target===e?(n.removeEventListener("scroll",t),n.scrollTo({top:e.scrollTop/g}),s()):(e.removeEventListener("scroll",t),e.scrollTo({top:n.scrollTop*g}),s())};return[()=>{s().finally(()=>{e.dispatchEvent(new Event("scroll"))})},()=>{e.removeEventListener("scroll",t),n.removeEventListener("scroll",t)}]},Sr=(e,n,s)=>{const{view:t}=s,l=f=>t.lineBlockAt(t.state.doc.line(f).from).top,i=f=>t.lineBlockAt(t.state.doc.line(f).from).height;let u=[];const o=()=>{u=[];const f=Array.from(n.querySelectorAll("[data-line]")).map(b=>Number(b.dataset.line)+1),{lines:w}=t.state.doc;let $=1,k=f.shift()??w;for(let b=1;b<=w;b++)b===k&&($=b,k=f.shift()||w+1),u.push({start:$,end:k-1})};let m=0,g=0;const c=de.throttle(f=>{var k,b,p,x,C,y,S;if(!((k=n.firstElementChild)!=null&&k.firstElementChild))return;const w=t.lineBlockAtHeight(t.scrollDOM.scrollTop),{number:$}=t.state.doc.lineAt(w.from);if(!($>u.length)&&!(t.state.doc.lines<u[u.length-1].end))if(f.target===e){if(g!==0)return;m++;const j=u[$-1],T=l(j.end)+i(j.end);let N=0;const H=l(j.start),L=n.querySelector(`[data-line="${j.start-1}"]`)||((b=n.firstElementChild)==null?void 0:b.firstElementChild),D=n.querySelector(`[data-line="${j.end}"]`)||((p=n.lastElementChild)==null?void 0:p.lastElementChild);let O=0,E=0;H===0?(N=(t.scrollDOM.scrollTop-H)/(T-H),O=D.offsetTop):T>t.scrollDOM.scrollHeight-t.scrollDOM.clientHeight?(N=(t.scrollDOM.scrollTop-H)/(t.scrollDOM.scrollHeight-t.scrollDOM.clientHeight-H),E=L.offsetTop,O=n.scrollHeight-n.clientHeight-E+10):(N=(t.scrollDOM.scrollTop-H)/(T-H),E=L.offsetTop,O=D.offsetTop-E);const G=E-10+O*N;de.smoothScroll(n,G,()=>{m--})}else{if(m!==0)return;g++;const j=Array.from(n.querySelectorAll("[data-line]")),T=n.scrollTop,N=n.scrollHeight;let H=j.length===0?1:Math.ceil(Number(j[j.length-1].dataset.line)*(T/N)),L=(x=n.firstElementChild)==null?void 0:x.firstElementChild;for(let F=H;F>=0;F--){const _=n.querySelector(`[data-line="${F}"]`);if(_&&_.offsetTop<=T){L=_,H=F;break}}let D=(C=n.firstElementChild)==null?void 0:C.firstElementChild,O=(y=n.firstElementChild)==null?void 0:y.lastElementChild;for(;j.length>0;){const F=j.indexOf(L);if(F+1>=j.length)break;const _=j[F+1];if(F===-1){O=_;break}const le=L.offsetTop;if(le>T){if(F===0){D=L,O=_;break}L=j[F-1];continue}const ge=_.offsetTop;if(le<=T&&ge>T){D=L,O=_;break}L=_}const E=D.offsetTop,G=O.offsetTop;let U=0;const{start:re,end:Y}=u[Number(D.dataset.line||0)],J=l(re);let z=l(Y);const K=i(Y);let W=0;D===((S=n.firstElementChild)==null?void 0:S.firstElementChild)?(U=Math.max(T/G,0),W=z+K-J):z>t.scrollDOM.scrollHeight-t.scrollDOM.clientHeight?(U=Math.max((T-E)/(n.scrollHeight-E-n.clientHeight),0),z=l(t.state.doc.lines)+i(t.state.doc.lines),W=8+z-J-e.clientHeight):(U=Math.max((T-E)/(G-E),0),W=z+K-J),de.smoothScroll(e,J+W*U,()=>{g--})}},10);return[()=>{o(),e.addEventListener("scroll",c),n.addEventListener("scroll",c),e.dispatchEvent(new Event("scroll"))},()=>{u=[],e.removeEventListener("scroll",c),n.removeEventListener("scroll",c)}]},Er=(e,n,s)=>{const{editorId:t}=d.useContext(P),[l,i]=d.useState({clear(){},init(){}});d.useEffect(()=>{l.clear();const u=document.querySelector(".cm-scroller"),o=document.querySelector(`[id="${t}-preview-wrapper"][data-show="true"]`),m=document.querySelector(`[id="${t}-html-wrapper"][data-show="true"]`);if(o||m){const g=o?Sr:jr,c=o||m,[f,w]=g(u,c,s.current);i({init:f,clear:w})}},[n,e.setting.fullscreen,e.setting.pageFullscreen,e.setting.preview,e.setting.htmlPreview]),d.useEffect(()=>(e.scrollAuto?l.init():l.clear(),()=>{l.clear()}),[l,e.scrollAuto])},Nr=Er,Mr=(e,n,s)=>{var c,f,w,$,k,b;let t="",l=0,i=0,u=!0,o=!1;const m=n.getSelectedText(),g=(c=r.configOption.editorConfig)==null?void 0:c.mermaidTemplate;if(/^h[1-6]{1}$/.test(e)){const p=e.replace(/^h(\d)/,(x,C)=>new Array(Number(C)).fill("#",0,C).join(""));t=`${p} ${m}`,l=p.length+1}else if(e==="prettier"){const p=window.prettier||((w=(f=r.configOption.editorExtensions)==null?void 0:f.prettier)==null?void 0:w.prettierInstance),x=[(($=window.prettierPlugins)==null?void 0:$.markdown)||((b=(k=r.configOption.editorExtensions)==null?void 0:k.prettier)==null?void 0:b.parserMarkdownInstance)];!p||x[0]===void 0?(v.bus.emit(s.editorId,"errorCatcher",{name:"prettier",message:"prettier is undefined"}),t=n.getValue()):t=p.format(n.getValue(),{parser:"markdown",plugins:x}),u=!1,o=!0}else switch(e){case"bold":{t=`**${m}**`,l=2,i=-2;break}case"underline":{t=`<u>${m}</u>`,l=3,i=-4;break}case"italic":{t=`*${m}*`,l=1,i=-1;break}case"strikeThrough":{t=`~~${m}~~`,l=2,i=-2;break}case"sub":{t=`<sub>${m}</sub>`,l=5,i=-6;break}case"sup":{t=`<sup>${m}</sup>`,l=5,i=-6;break}case"codeRow":{t="`"+m+"`",l=1,i=-1;break}case"quote":{t=`> ${m}`,l=2;break}case"orderedList":{t=`1. ${m}`,l=3;break}case"unorderedList":{t=`- ${m}`,l=2;break}case"task":{t=`- [ ] ${m}`,l=6;break}case"code":{const p=s.text||m||"",x=s.mode||"language";t=`\`\`\`${x}
${p}
\`\`\`
`,l=3,i=3+x.length-t.length;break}case"table":{t="|";const{selectedShape:p={x:1,y:1}}=s,{x,y:C}=p;for(let y=0;y<=C;y++)t+=" col |";t+=`
|`;for(let y=0;y<=C;y++)t+=" - |";for(let y=0;y<=x;y++){t+=`
|`;for(let S=0;S<=C;S++)t+=" content |"}l=2,i=5-t.length;break}case"link":{const{desc:p,url:x}=s;t=`[${p}](${x})`,u=!1;break}case"image":{const{desc:p,url:x,urls:C}=s;C instanceof Array?t=C.reduce((y,S)=>y+`![${p}](${S})
`,""):t=`![${p}](${x})
`,u=!1;break}case"flow":{t=`\`\`\`mermaid
${(g==null?void 0:g.flow)||`flowchart TD 
  Start --> Stop`}
\`\`\`
`,l=3,i=10-t.length;break}case"sequence":{t=`\`\`\`mermaid
${(g==null?void 0:g.sequence)||`sequenceDiagram
  A->>B: hello!
  B-->>A: hi!
  A-)B: bye!`}
\`\`\`
`,l=3,i=10-t.length;break}case"gantt":{t=`\`\`\`mermaid
${(g==null?void 0:g.gantt)||`gantt
title A Gantt Diagram
dateFormat  YYYY-MM-DD
section Section
A task  :a1, 2014-01-01, 30d
Another task  :after a1, 20d`}
\`\`\`
`,l=3,i=10-t.length;break}case"class":{t=`\`\`\`mermaid
${(g==null?void 0:g.class)||`classDiagram
  class Animal
  Vehicle <|-- Car`}
\`\`\`
`,l=3,i=10-t.length;break}case"state":{t=`\`\`\`mermaid
${(g==null?void 0:g.state)||`stateDiagram-v2
  s1 --> s2`}
\`\`\`
`,l=3,i=10-t.length;break}case"pie":{t=`\`\`\`mermaid
${(g==null?void 0:g.pie)||`pie title Pets adopted by volunteers
  "Dogs" : 386
  "Cats" : 85
  "Rats" : 15`}
\`\`\`
`,l=3,i=10-t.length;break}case"relationship":{t=`\`\`\`mermaid
${(g==null?void 0:g.relationship)||`erDiagram
  CAR ||--o{ NAMED-DRIVER : allows
  PERSON ||--o{ NAMED-DRIVER : is`}
\`\`\`
`,l=3,i=10-t.length;break}case"journey":{t=`\`\`\`mermaid
${(g==null?void 0:g.journey)||`journey
  title My working day
  section Go to work
    Make tea: 5: Me
    Go upstairs: 3: Me
    Do work: 1: Me, Cat
  section Go home
    Go downstairs: 5: Me
    Sit down: 5: Me`}
\`\`\`
`,l=3,i=10-t.length;break}case"katexInline":{t="$$",l=1,i=-1;break}case"katexBlock":{t=`$$

$$
`,l=3,i=-4;break}case"universal":{const{generate:p}=s,x=p(m);t=x.targetValue,u=x.select,l=x.deviationStart,i=x.deviationEnd}}return{text:t,options:{select:u,deviationStart:l,deviationEnd:i,replaceAll:o}}},ne=e=>{const n=new q.Compartment;return t=>(n.get(e.state)?e.dispatch({effects:n.reconfigure(t)}):e.dispatch({effects:q.StateEffect.appendConfig.of(n.of(t))}),!0)};class Hr{constructor(n){ee(this,"view");ee(this,"toggleTabSize");ee(this,"togglePlaceholder");ee(this,"setExtensions");ee(this,"toggleDisabled");ee(this,"toggleReadOnly");ee(this,"toggleMaxlength");this.view=n,this.toggleTabSize=ne(this.view),this.togglePlaceholder=ne(this.view),this.setExtensions=ne(this.view),this.toggleDisabled=ne(this.view),this.toggleReadOnly=ne(this.view),this.toggleMaxlength=ne(this.view)}getValue(){return this.view.state.doc.toString()}setValue(n,s=0,t=this.view.state.doc.length){this.view.dispatch({changes:{from:s,to:t,insert:n}})}getSelectedText(){const{from:n,to:s}=this.view.state.selection.main;return this.view.state.sliceDoc(n,s)}replaceSelectedText(n,s={select:!0,deviationStart:0,deviationEnd:0,replaceAll:!1}){if(s.replaceAll){this.setValue(n);return}const{from:t}=this.view.state.selection.main;if(this.view.dispatch(this.view.state.replaceSelection(n)),s.select){const l=t+n.length+s.deviationEnd;this.view.dispatch({selection:q.EditorSelection.create([q.EditorSelection.range(t+s.deviationStart,l),q.EditorSelection.cursor(l)],1)})}this.view.focus()}setTabSize(n){this.toggleTabSize([q.EditorState.tabSize.of(n),fe.indentUnit.of(" ".repeat(n))])}setPlaceholder(n){this.togglePlaceholder(ue.placeholder(n))}focus(n){if(this.view.focus(),!n)return;let s=0,t=0,l=0;switch(n){case"start":break;case"end":{s=t=l=this.getValue().length;break}default:s=n.rangeAnchor||n.cursorPos,t=n.rangeHead||n.cursorPos,l=n.cursorPos}this.view.dispatch({scrollIntoView:!0,selection:q.EditorSelection.create([q.EditorSelection.range(s,t),q.EditorSelection.cursor(l)],1)})}setDisabled(n){this.toggleDisabled([ue.EditorView.editable.of(!n)])}setReadOnly(n){this.toggleReadOnly([q.EditorState.readOnly.of(n)])}setMaxLength(n){this.toggleMaxlength([q.EditorState.changeFilter.of(s=>s.newDoc.length<=n)])}}const Lr="#e5c07b",Lt="var(--md-color)",Ir="#56b6c2",Pr="#ffffff",ae="var(--md-color)",It="#e5c07b",Ar="#e5c07b",Rr="var(--md-color)",Pt="#d19a66",Dr="#c678dd",Or="#21252b",Fr="#2c313a",At="var(--md-bk-color)",be="var(--md-bk-color)",_r="#ceedfa33",Rt="#528bff",qr=ue.EditorView.theme({"&":{color:ae,backgroundColor:At},".cm-content":{caretColor:Rt},".cm-cursor, .cm-dropCursor":{borderLeftColor:Rt},"&.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground, .cm-selectionBackground, .cm-content ::selection":{backgroundColor:_r},".cm-panels":{backgroundColor:Or,color:ae},".cm-panels.cm-panels-top":{borderBottom:"2px solid black"},".cm-panels.cm-panels-bottom":{borderTop:"2px solid black"},".cm-searchMatch":{backgroundColor:"#72a1ff59",outline:"1px solid #457dff"},".cm-searchMatch.cm-searchMatch-selected":{backgroundColor:"#6199ff2f"},".cm-activeLine":{backgroundColor:"#ceedfa33"},".cm-selectionMatch":{backgroundColor:"#aafe661a"},"&.cm-focused .cm-matchingBracket, &.cm-focused .cm-nonmatchingBracket":{backgroundColor:"#bad0f847"},".cm-gutters":{backgroundColor:At,color:ae,borderRight:"1px solid",borderColor:"var(--md-border-color)"},".cm-activeLineGutter":{backgroundColor:Fr},".cm-foldPlaceholder":{backgroundColor:"transparent",border:"none",color:"#ddd"},".cm-tooltip":{border:"1px solid var(--md-border-color)",backgroundColor:be},".cm-tooltip .cm-tooltip-arrow:before":{borderTopColor:"transparent",borderBottomColor:"transparent"},".cm-tooltip .cm-tooltip-arrow:after":{borderTopColor:be,borderBottomColor:be},".cm-tooltip-autocomplete":{"& > ul > li[aria-selected]":{color:ae}}},{dark:!0}),Vr=fe.HighlightStyle.define([{tag:h.tags.keyword,color:Dr},{tag:[h.tags.name,h.tags.deleted,h.tags.character,h.tags.propertyName,h.tags.macroName],color:Lt},{tag:[h.tags.function(h.tags.variableName),h.tags.labelName],color:Ar},{tag:[h.tags.color,h.tags.constant(h.tags.name),h.tags.standard(h.tags.name)],color:Pt},{tag:[h.tags.definition(h.tags.name),h.tags.separator],color:ae},{tag:[h.tags.typeName,h.tags.className,h.tags.number,h.tags.changed,h.tags.annotation,h.tags.modifier,h.tags.self,h.tags.namespace],color:Lr},{tag:[h.tags.operator,h.tags.operatorKeyword,h.tags.url,h.tags.escape,h.tags.regexp,h.tags.link,h.tags.special(h.tags.string)],color:Ir},{tag:[h.tags.meta,h.tags.comment],color:It},{tag:h.tags.strong,fontWeight:"bold"},{tag:h.tags.emphasis,fontStyle:"italic"},{tag:h.tags.strikethrough,textDecoration:"line-through"},{tag:h.tags.link,color:It,textDecoration:"underline"},{tag:h.tags.heading,fontWeight:"bold",color:Lt},{tag:[h.tags.atom,h.tags.bool,h.tags.special(h.tags.variableName)],color:Pt},{tag:[h.tags.processingInstruction,h.tags.string,h.tags.inserted],color:Rr},{tag:h.tags.invalid,color:Pr}]),Br=[qr,fe.syntaxHighlighting(Vr)],Ur="#e5c07b",Dt="#3f4a54",Kr="#56b6c2",Gr="#fff",ce="#3f4a54",Ot="#2d8cf0",zr="#2d8cf0",Wr="#3f4a54",Ft="#d19a66",Zr="#c678dd",Yr="#21252b",Jr="#ceedfa33",_t="var(--md-bk-color)",xe="var(--md-bk-color)",Xr="#bad5fa",qt="#3f4a54",Qr=ue.EditorView.theme({"&":{color:ce,backgroundColor:_t},".cm-content":{caretColor:qt},".cm-cursor, .cm-dropCursor":{borderLeftColor:qt},"&.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground, .cm-selectionBackground, .cm-content ::selection":{backgroundColor:Xr},".cm-panels":{backgroundColor:Yr,color:ce},".cm-panels.cm-panels-top":{borderBottom:"2px solid black"},".cm-panels.cm-panels-bottom":{borderTop:"2px solid black"},".cm-searchMatch":{backgroundColor:"#72a1ff59",outline:"1px solid #457dff"},".cm-searchMatch.cm-searchMatch-selected":{backgroundColor:"#6199ff2f"},".cm-activeLine":{backgroundColor:"#ceedfa33"},".cm-selectionMatch":{backgroundColor:"#aafe661a"},"&.cm-focused .cm-matchingBracket, &.cm-focused .cm-nonmatchingBracket":{backgroundColor:"#bad0f847"},".cm-gutters":{backgroundColor:_t,color:ce,borderRight:"1px solid",borderColor:"var(--md-border-color)"},".cm-activeLineGutter":{backgroundColor:Jr},".cm-foldPlaceholder":{backgroundColor:"transparent",border:"none",color:"#ddd"},".cm-tooltip":{border:"1px solid var(--md-border-color)",backgroundColor:xe},".cm-tooltip .cm-tooltip-arrow:before":{borderTopColor:"transparent",borderBottomColor:"transparent"},".cm-tooltip .cm-tooltip-arrow:after":{borderTopColor:xe,borderBottomColor:xe},".cm-tooltip-autocomplete":{"& > ul > li[aria-selected]":{color:ce}}}),en=fe.HighlightStyle.define([{tag:h.tags.keyword,color:Zr},{tag:[h.tags.name,h.tags.deleted,h.tags.character,h.tags.propertyName,h.tags.macroName],color:Dt},{tag:[h.tags.function(h.tags.variableName),h.tags.labelName],color:zr},{tag:[h.tags.color,h.tags.constant(h.tags.name),h.tags.standard(h.tags.name)],color:Ft},{tag:[h.tags.definition(h.tags.name),h.tags.separator],color:ce},{tag:[h.tags.typeName,h.tags.className,h.tags.number,h.tags.changed,h.tags.annotation,h.tags.modifier,h.tags.self,h.tags.namespace],color:Ur},{tag:[h.tags.operator,h.tags.operatorKeyword,h.tags.url,h.tags.escape,h.tags.regexp,h.tags.link,h.tags.special(h.tags.string)],color:Kr},{tag:[h.tags.meta,h.tags.comment],color:Ot},{tag:h.tags.strong,fontWeight:"bold"},{tag:h.tags.emphasis,fontStyle:"italic"},{tag:h.tags.strikethrough,textDecoration:"line-through"},{tag:h.tags.link,color:Ot,textDecoration:"underline"},{tag:h.tags.heading,fontWeight:"bold",color:Dt},{tag:[h.tags.atom,h.tags.bool,h.tags.special(h.tags.variableName)],color:Ft},{tag:[h.tags.processingInstruction,h.tags.string,h.tags.inserted],color:Wr},{tag:h.tags.invalid,color:Gr}]),tn=[Qr,fe.syntaxHighlighting(en)],he=(e,n,s,t,l)=>(i,u,o,m)=>{const g=`${e}${n}`.slice(m-o);i.dispatch(i.state.replaceSelection(`${g}${s}${t}`));const c=o+u.label.length+(l==="title"?s.length:0);i.dispatch({selection:q.EditorSelection.create([q.EditorSelection.range(o+u.label.length+(l==="title"?1:-n.length),c),q.EditorSelection.cursor(c)],1)}),i.focus()},Vt=e=>(n,s,t,l)=>{const i=e.slice(l-t);n.dispatch(n.state.replaceSelection(`${i} `))},rn=e=>{const n=s=>{const t=s.matchBefore(/^#+|^-\s*\[*\s*\]*|`+|\[|!\[*|^\|\s?\|?|^\$\$?|!+\s*\w*/);return t===null||t.from==t.to&&s.explicit?null:{from:t.from,options:[...["h1","h2","h3","h4","h5","h6"].map((l,i)=>{const u=new Array(i+1).fill("#").join("");return{label:u,type:"text",apply:Vt(u)}}),...["unchecked","checked"].map(l=>{const i=l==="checked"?"- [x]":"- [ ]";return{label:i,type:"text",apply:Vt(i)}}),...[["`",""],["```","language"],["```mermaid\n",""]].map(l=>({label:`${l[0]}${l[1]}`,type:"text",apply:he(l[0],l[1],"",l[0]==="`"?"`":"\n```","type")})),{label:"[]()",type:"text"},{label:"![]()",type:"text"},{label:"| |",type:"text",detail:"table",apply:`| col | col | col |
| - | - | - |
| content | content | content |
| content | content | content |`},{label:"$",type:"text",apply:he("$","","","$","type")},{label:"$$",type:"text",apply:he("$$","",`
`,`
$$`,"title")},...["note","abstract","info","tip","success","question","warning","failure","danger","bug","example","quote","hint","caution","error","attention"].map(l=>({label:`!!! ${l}`,type:"text",apply:he("!!!",` ${l}`," Title",`

!!!`,"title")}))]}};return lr.autocompletion({override:e?[n,...e]:[n]})},nn=rn,ln=(e,n)=>{const s={key:"Ctrl-b",mac:"Cmd-b",run:()=>(v.bus.emit(e,"replace","bold"),!0)},t={key:"Ctrl-s",mac:"Cmd-s",run:S=>(v.bus.emit(e,me,S.state.doc.toString()),!0),shift:()=>(v.bus.emit(e,"replace","strikeThrough"),!0)},l={key:"Ctrl-u",mac:"Cmd-u",run:()=>(v.bus.emit(e,"replace","underline"),!0),shift:()=>(v.bus.emit(e,"replace","unorderedList"),!0)},i={key:"Ctrl-i",mac:"Cmd-i",run:()=>(v.bus.emit(e,"replace","italic"),!0),shift:()=>(v.bus.emit(e,"openModals","image"),!0)},u={key:"Ctrl-1",mac:"Cmd-1",run:()=>(v.bus.emit(e,"replace","h1"),!0)},o={key:"Ctrl-2",mac:"Cmd-2",run:()=>(v.bus.emit(e,"replace","h2"),!0)},m={key:"Ctrl-3",mac:"Cmd-3",run:()=>(v.bus.emit(e,"replace","h3"),!0)},g={key:"Ctrl-4",mac:"Cmd-4",run:()=>(v.bus.emit(e,"replace","h4"),!0)},c={key:"Ctrl-5",mac:"Cmd-5",run:()=>(v.bus.emit(e,"replace","h5"),!0)},f={key:"Ctrl-6",mac:"Cmd-6",run:()=>(v.bus.emit(e,"replace","h6"),!0)},w={key:"Ctrl-ArrowUp",mac:"Cmd-ArrowUp",run:()=>(v.bus.emit(e,"replace","sup"),!0)},$={key:"Ctrl-ArrowDown",mac:"Cmd-ArrowDown",run:()=>(v.bus.emit(e,"replace","sub"),!0)},k={key:"Ctrl-o",mac:"Cmd-o",run:()=>(v.bus.emit(e,"replace","orderedList"),!0)},b={key:"Ctrl-c",mac:"Cmd-c",shift:()=>(v.bus.emit(e,"replace","code"),!0),any(S,j){return(j.ctrlKey||j.metaKey)&&j.altKey&&j.code==="KeyC"?(v.bus.emit(e,"replace","codeRow"),!0):!1}},p={key:"Ctrl-l",mac:"Cmd-l",run:()=>(v.bus.emit(e,"openModals","link"),!0)},x={key:"Ctrl-f",mac:"Cmd-f",shift:()=>n.noPrettier?!1:(v.bus.emit(e,"replace","prettier"),!0)},C={any:(S,j)=>(j.ctrlKey||j.metaKey)&&j.altKey&&j.shiftKey&&j.code==="KeyT"?(v.bus.emit(e,"replace","table"),!0):!1},y={key:"Ctrl-d",mac:"Cmd-d",run:pe.deleteLine,preventDefault:!0};return[s,y,t,l,i,u,o,m,g,c,f,w,$,k,b,p,x,C]},on=ln,sn=e=>{const{editorId:n}=d.useContext(P);return t=>{if(t.clipboardData){if(t.clipboardData.files.length>0){const{files:l}=t.clipboardData;v.bus.emit(n,"uploadImage",Array.from(l).filter(i=>/image\/.*/.test(i.type))),t.preventDefault()}if(e.autoDetectCode&&t.clipboardData.types.includes("vscode-editor-data")){const l=JSON.parse(t.clipboardData.getData("vscode-editor-data"));v.bus.emit(n,"replace","code",{mode:l.mode,text:t.clipboardData.getData("text/plain")}),t.preventDefault()}}}},an=sn,cn=e=>{const{editorId:n}=d.useContext(P);v.bus.on(n,{name:Kt,callback(s){var t;(t=e.current)==null||t.focus(s)}})},dn=cn,un=e=>{const{tabWidth:n,editorId:s,theme:t}=d.useContext(P),l=d.useRef(null),i=d.useRef(),[u]=d.useState(()=>on(s,e)),o=d.useRef(!0),m=an(e),[g]=d.useState(()=>[ue.keymap.of([...u,pe.indentWithTab]),se.minimalSetup,nr.markdown({codeLanguages:rr.languages}),se.EditorView.lineWrapping,se.EditorView.updateListener.of(f=>{f.docChanged&&e.onChange(f.state.doc.toString())}),se.EditorView.domEventHandlers({paste:m,blur:e.onBlur,focus:e.onFocus})]),c=d.useMemo(()=>r.configOption.codeMirrorExtensions(t,[...g,t==="light"?tn:Br,nn(e.completions)],[...u]),[e.completions,t]);return d.useEffect(()=>{const f=new se.EditorView({doc:e.value,parent:l.current}),w=new Hr(f);return i.current=w,setTimeout(()=>{w.setTabSize(n),w.setDisabled(e.disabled),w.setReadOnly(e.readOnly),w.setExtensions(c),e.placeholder&&w.setPlaceholder(e.placeholder),typeof e.maxLength=="number"&&w.setMaxLength(e.maxLength),e.autoFocus&&f.focus(),o.current=!1},0),v.bus.on(s,{name:"ctrlZ",callback(){pe.undo(f)}}),v.bus.on(s,{name:"ctrlShiftZ",callback(){pe.redo(f)}}),v.bus.on(s,{name:"replace",callback($,k={}){var x;const{text:b,options:p}=Mr($,i.current,k);(x=i.current)==null||x.replaceSelectedText(b,p)}}),()=>{f.destroy(),o.current=!0}},[]),d.useEffect(()=>{var f;o.current||(f=i.current)==null||f.setExtensions(c)},[c]),d.useEffect(()=>{var f,w;((f=i.current)==null?void 0:f.getValue())!==e.value&&((w=i.current)==null||w.setValue(e.value))},[e.value]),d.useEffect(()=>{var f;o.current||(f=i.current)==null||f.setTabSize(n)},[n]),d.useEffect(()=>{var f;o.current||(f=i.current)==null||f.setPlaceholder(e.placeholder)},[e.placeholder]),d.useEffect(()=>{var f;o.current||(f=i.current)==null||f.setDisabled(e.disabled)},[e.disabled]),d.useEffect(()=>{var f;o.current||(f=i.current)==null||f.setDisabled(e.readOnly)},[e.readOnly]),d.useEffect(()=>{var f;o.current||typeof e.maxLength=="number"&&((f=i.current)==null||f.setMaxLength(e.maxLength))},[e.maxLength]),dn(i),{inputWrapperRef:l,codeMirrorUt:i}},mn=un,fn=(e,n)=>{const{editorId:s}=d.useContext(P);d.useEffect(()=>(()=>{const l=document.querySelectorAll(`#${s}-preview img`),i=Yt(l,{background:"#00000073"});return()=>{i.detach()}})(),[n,e.setting])},gn=fn,hn=(e,n)=>{var i,u,o;const{editorId:s,usedLanguageText:t}=d.useContext(P),{formatCopiedText:l=m=>m}=e;d.useEffect(()=>{e.setting.preview&&document.querySelectorAll(`#${s} .${r.prefix}-preview pre`).forEach(m=>{var w,$;let g=-1;(w=m.querySelector(".copy-button"))==null||w.remove();const c=(($=t.copyCode)==null?void 0:$.text)||"复制代码",f=document.createElement("span");f.setAttribute("class","copy-button"),f.dataset.tips=c,f.innerHTML=`<svg class="${r.prefix}-icon" aria-hidden="true"><use xlink:href="#${r.prefix}-icon-copy"></use></svg>`,f.addEventListener("click",()=>{var C,y;clearTimeout(g);const k=m.querySelector("code").innerText,b=Jt(l(k)),p=((C=t.copyCode)==null?void 0:C.successTips)||"已复制！",x=((y=t.copyCode)==null?void 0:y.failTips)||"已复制！";f.dataset.tips=b?p:x,g=window.setTimeout(()=>{f.dataset.tips=c},1500)}),m.appendChild(f)})},[l,n,e.setting.preview,(i=t.copyCode)==null?void 0:i.failTips,(u=t.copyCode)==null?void 0:u.successTips,(o=t.copyCode)==null?void 0:o.text])},pn=hn,bn=e=>{var o;const n=(o=r.configOption.editorExtensions)==null?void 0:o.highlight,s=n==null?void 0:n.instance,{highlight:t}=d.useContext(P),l=d.useRef(s),[i,u]=d.useState(!!s);return d.useEffect(()=>{V.updateHandler(`${r.prefix}-hlCss`,"href",t.css)},[t.css]),d.useEffect(()=>{if(!e.noHighlight&&!l.current){const m=document.createElement("script");m.src=t.js,m.onload=()=>{l.current=window.hljs,u(!0)},m.id=`${r.prefix}-hljs`,V.appendHandler(m,"hljs");const g=document.createElement("link");g.rel="stylesheet",g.href=t.css,g.id=`${r.prefix}-hlCss`,V.appendHandler(g)}},[]),{hljsRef:l,hljsInited:i}},xn=bn,kn=e=>{const{theme:n}=d.useContext(P),{editorExtensions:s}=r.configOption,t=s==null?void 0:s.mermaid,l=d.useRef(t==null?void 0:t.instance),[i,u]=d.useState(!1),[o]=d.useState(()=>new tr({max:1e3,ttl:6e5})),m=d.useCallback(()=>{o.clear();const c=l.current;!e.noMermaid&&c&&(c.initialize({startOnLoad:!1,theme:n==="dark"?"dark":"default"}),u(f=>!f))},[n]);return d.useEffect(m,[m]),d.useEffect(()=>{if(!e.noMermaid&&!(t!=null&&t.instance)){const c=(t==null?void 0:t.js)||r.mermaidUrl;if(/\.mjs/.test(c))import(c).then(f=>{l.current=f.default,m()});else{const f=document.createElement("script");f.id=`${r.prefix}-mermaid`,f.src=c,f.onload=()=>{l.current=window.mermaid,m()},V.appendHandler(f,"mermaid")}}},[]),{mermaidRef:l,reRender:i,replaceMermaid:()=>{if(!e.noMermaid&&l.current){const c=document.querySelectorAll(`div.${r.prefix}-mermaid`),f=document.createElement("div");f.style.width=document.body.offsetWidth+"px",f.style.height=document.body.offsetHeight+"px",f.style.position="fixed",f.style.zIndex="-10000",f.style.top="-10000",document.body.appendChild(f);let w=c.length;c.forEach(async $=>{let k=o.get($.innerText);if(!k){const p=v.uuid(),x=l.current.renderAsync||l.current.render;let C="";try{C=await x(p,$.innerText,f)}catch{}k=typeof C=="string"?C:C.svg,o.set($.innerText,k)}const b=document.createElement("p");b.className=`${r.prefix}-mermaid`,b.setAttribute("data-processed",""),b.innerHTML=k,$.dataset.line!==void 0&&(b.dataset.line=$.dataset.line),$.replaceWith(b),--w===0&&f.remove()})}}}},vn=kn,Cn=e=>{var u;const n=(u=r.configOption.editorExtensions)==null?void 0:u.katex,s=n==null?void 0:n.instance,t=d.useRef(s),[l,i]=d.useState(!!s);return d.useEffect(()=>{if(!e.noKatex&&!t.current){const o=document.createElement("script");o.src=(n==null?void 0:n.js)||r.katexUrl.js,o.onload=()=>{t.current=window.katex,i(!0)},o.id=`${r.prefix}-katex`;const m=document.createElement("link");m.rel="stylesheet",m.href=(n==null?void 0:n.css)||r.katexUrl.css,m.id=`${r.prefix}-katexCss`,V.appendHandler(o,"katex"),V.appendHandler(m)}}),{katexRef:t,katexInited:l}},$n=Cn,wn=(e,n)=>{const s=e.renderer.rules.fence.bind(e.renderer.rules);e.renderer.rules.fence=(t,l,i,u,o)=>{const m=t[l],g=m.content.trim();if(m.info==="mermaid"&&!n.noMermaid){let c;return t[l].map&&t[l].level===0&&(c=t[l].map[0],t[l].attrSet("data-line",String(c))),`<div class="${r.prefix}-mermaid" ${c!==void 0?"data-line="+c:""} data-mermaid-theme=${n.themeRef.current}>${g}</div>`}return s(t,l,i,u,o)}},yn=wn,Bt=(e,n)=>{let s=!0,t=!0;const l=e.posMax,i=n>0?e.src.charCodeAt(n-1):-1,u=n+1<=l?e.src.charCodeAt(n+1):-1;return(i===32||i===9||u>=48&&u<=57)&&(t=!1),(u===32||u===9)&&(s=!1),{can_open:s,can_close:t}},Tn=(e,n)=>{let s,t,l,i;if(e.src[e.pos]!=="$")return!1;if(l=Bt(e,e.pos),!l.can_open)return n||(e.pending+="$"),e.pos+=1,!0;const u=e.pos+1;for(s=u;(s=e.src.indexOf("$",s))!==-1;){for(i=s-1;e.src[i]==="\\";)i-=1;if((s-i)%2==1)break;s+=1}return s===-1?(n||(e.pending+="$"),e.pos=u,!0):s-u===0?(n||(e.pending+="$$"),e.pos=u+1,!0):(l=Bt(e,s),l.can_close?(n||(t=e.push("math_inline","math",0),t.markup="$",t.content=e.src.slice(u,s)),e.pos=s+1,!0):(n||(e.pending+="$"),e.pos=u,!0))},jn=(e,n,s,t)=>{let l,i,u,o,m=!1,g=e.bMarks[n]+e.tShift[n],c=e.eMarks[n];if(g+2>c||e.src.slice(g,g+2)!=="$$")return!1;if(g+=2,l=e.src.slice(g,c),t)return!0;for(l.trim().slice(-2)==="$$"&&(l=l.trim().slice(0,-2),m=!0),u=n;!m&&(u++,!(u>=s||(g=e.bMarks[u]+e.tShift[u],c=e.eMarks[u],g<c&&e.tShift[u]<e.blkIndent)));)e.src.slice(g,c).trim().slice(-2)==="$$"&&(o=e.src.slice(0,c).lastIndexOf("$$"),i=e.src.slice(g,o),m=!0);e.line=u+1;const f=e.push("math_block","math",0);return f.block=!0,f.content=(l&&l.trim()?l+`
`:"")+e.getLines(n+1,u,e.tShift[n],!0)+(i&&i.trim()?i:""),f.map=[n,e.line],f.markup="$$",!0},Sn=(e,n)=>{const s=l=>{if(n.katexRef.current){const i=n.katexRef.current.renderToString(l,{throwOnError:!1});return`<span class="${r.prefix}-katex-inline" data-processed>${i}</span>`}else return`<span class="${r.prefix}-katex-inline">${l}</span>`},t=(l,i)=>{if(n.katexRef.current){const u=n.katexRef.current.renderToString(l,{throwOnError:!1,displayMode:!0});return`<p class="${r.prefix}-katex-block" data-line=${i} data-processed>${u}</p>`}else return`<p class="${r.prefix}-katex-block" data-line=${i}>${l}</p>`};e.inline.ruler.after("escape","math_inline",Tn),e.block.ruler.after("blockquote","math_block",jn,{alt:["paragraph","reference","blockquote","list"]}),e.renderer.rules.math_inline=(l,i)=>s(l[i].content),e.renderer.rules.math_block=(l,i)=>t(l[i].content,l[i].map[0])+`
`},En=Sn,Nn=(e,n)=>{n=n||{};const s=3,t=n.marker||"!",l=t.charCodeAt(0),i=t.length;let u="",o="";const m=(c,f,w,$,k)=>{const b=c[f];return b.type==="admonition_open"?(c[f].attrPush(["class",`${r.prefix}-admonition ${r.prefix}-admonition-${b.info}`]),c[f].attrSet("data-line",String(c[f].map[0]))):b.type==="admonition_title_open"&&c[f].attrPush(["class",`${r.prefix}-admonition-title`]),k.renderToken(c,f,w)},g=c=>{const f=c.trim().split(" ",2);o="",u=f[0],f.length>1&&(o=c.substring(u.length+2)),(o===""||!o)&&(o=u)};e.block.ruler.before("code","admonition",(c,f,w,$)=>{let k,b,p,x=!1,C=c.bMarks[f]+c.tShift[f],y=c.eMarks[f];if(l!==c.src.charCodeAt(C))return!1;for(k=C+1;k<=y&&t[(k-C)%i]===c.src[k];k++);const S=Math.floor((k-C)/i);if(S!==s)return!1;k-=(k-C)%i;const j=c.src.slice(C,k),T=c.src.slice(k,y);if(g(T),$)return!0;for(b=f;b++,!(b>=w||(C=c.bMarks[b]+c.tShift[b],y=c.eMarks[b],C<y&&c.sCount[b]<c.blkIndent));)if(l===c.src.charCodeAt(C)&&!(c.sCount[b]-c.blkIndent>=4)){for(k=C+1;k<=y&&t[(k-C)%i]===c.src[k];k++);if(!(Math.floor((k-C)/i)<S)&&(k-=(k-C)%i,k=c.skipSpaces(k),!(k<y))){x=!0;break}}const N=c.parentType,H=c.lineMax;return c.parentType="root",c.lineMax=b,p=c.push("admonition_open","div",1),p.markup=j,p.block=!0,p.info=u,p.map=[f,b],p=c.push("admonition_title_open","p",1),p.markup=j+" "+u,p.map=[f,b],p=c.push("inline","",0),p.content=o,p.map=[f,c.line-1],p.children=[],p=c.push("admonition_title_close","p",-1),p.markup=j+" "+u,c.md.block.tokenize(c,f+1,b),p=c.push("admonition_close","div",-1),p.markup=c.src.slice(C,k),p.block=!0,c.parentType=N,c.lineMax=H,c.line=b+(x?1:0),!0},{alt:["paragraph","reference","blockquote","list"]}),e.renderer.rules.admonition_open=m,e.renderer.rules.admonition_title_open=m,e.renderer.rules.admonition_title_close=m,e.renderer.rules.admonition_close=m},Mn=Nn,Hn=(e,n)=>{let s;e.core.ruler.push("headingLinks",t=>{s||(s=t.Token)}),e.renderer.rules.heading_open=(t,l)=>{const i=t[l],u=t[l+1].content,o=i.markup.length;return n.headsRef.current.push({text:u,level:o}),i.map&&i.level===0&&(i.attrSet("data-line",String(i.map[0])),i.attrSet("id",n.mdHeadingId(u,o,n.headsRef.current.length))),e.renderer.renderToken(t,l,n)},e.renderer.rules.heading_close=(t,l,i,u,o)=>o.renderToken(t,l,i)},Ln=Hn,In=(e,n)=>{const s=e.renderer.rules.fence,t=e.utils.unescapeAll,l=/\[(\w*)(?::([\w ]*))?\]/;function i(g){return g.info?t(g.info).trim():""}function u(g){const c=i(g),[f=null,w=""]=(l.exec(c)||[]).slice(1);return[f,w]}function o(g){const c=i(g);return c?c.split(/(\s+)/g)[0]:""}const m=(g,c,f,w,$)=>{if(g[c].hidden)return"";const[k,b]=u(g[c]);if(k===null)return s(g,c,f,w,$);let p,x,C,y,S="",j="";for(let T=c;T<g.length&&(p=g[T],[x,C]=u(p),x===k);T++)p.info=p.info.replace(l,""),p.hidden=!0,y=T-c>0?"":" checked",S+=`<li><input type="radio" name="label-group-${n.editorId}-${c}"${y}><label for="group-${n.editorId}-${c}-tab-${T-c}" onclick="this.previousElementSibling.click()">${C||o(p)}</label></li>
`,j+=`<input type="radio" id="group-${n.editorId}-${c}-tab-${T-c}" name="group-${n.editorId}-${c}"${y}>
`+s(g,T,f,w,$);return`<div class="code-tabs">
<ul>
`+S+`</ul>
`+j+"</div>"};e.renderer.rules.fence=m},Pn=In,An=e=>{["paragraph_open","table_open","ordered_list_open","bullet_list_open","blockquote_open","hr"].forEach(n=>{e.renderer.rules[n]=(s,t,l,i,u)=>{let o;return s[t].map&&s[t].level===0&&(o=s[t].map[0],s[t].attrSet("data-line",String(o))),u.renderToken(s,t,l)}}),["html_block","fence"].forEach(n=>{const s=e.renderer.rules[n];e.renderer.rules[n]=(t,l,i,u,o)=>{let m;const g=s(t,l,i,u,o);return t[l].map&&t[l].level===0?(m=t[l].map[0],g.replace(/^(<[^>]*)/,`$1 data-line="${m}"`)):g}})},Rn=(e,n)=>{const{onHtmlChanged:s=()=>{},onGetCatalog:t=()=>{}}=e,{editorConfig:l,markdownItConfig:i}=r.configOption,{editorId:u,showCodeRowNumber:o,theme:m}=d.useContext(P),g=d.useRef([]),c=d.useRef(m);d.useEffect(()=>{c.current=m},[m]);const{hljsRef:f,hljsInited:w}=xn(e),{katexRef:$,katexInited:k}=$n(e),{reRender:b,replaceMermaid:p}=vn(e),[x]=d.useState(()=>{const T=Xt({html:!0,breaks:!0});return i(T),T.use(En,{katexRef:$}),T.use(Qt,{figcaption:!0}),T.use(Mn),T.use(er),T.use(Ln,{mdHeadingId:e.mdHeadingId,headsRef:g}),T.use(Pn,{editorId:u}),e.noMermaid||T.use(yn,{themeRef:c,noMermaid:e.noMermaid}),T.set({highlight:(N,H)=>{let L;!e.noHighlight&&f.current?f.current.getLanguage(H)?L=f.current.highlight(N,{language:H,ignoreIllegals:!0}).value:L=f.current.highlightAuto(N).value:L=x.utils.escapeHtml(N);const D=o?v.generateCodeRowNumber(L.trim()):`<span class="code-block">${L.trim()}</span>`;return`<pre><code class="language-${H}" language=${H}>${D}</code></pre>`}}),An(T),T}),[C,y]=d.useState(()=>e.sanitize(x.render(e.value))),S=d.useMemo(()=>(e.noHighlight||w)&&(e.noKatex||k),[w,k]),j=d.useRef(!0);return d.useEffect(()=>{v.bus.emit(u,"buildFinished",C),s(C),t(g.current),v.bus.emit(u,"catalogChanged",g.current)},[C]),d.useEffect(()=>{if(j.current){j.current=!1;return}const T=setTimeout(()=>{g.current=[];const N=e.sanitize(x.render(e.value));y(N)},(l==null?void 0:l.renderDelay)!==void 0?l==null?void 0:l.renderDelay:n?0:500);return()=>{clearTimeout(T)}},[e.value,S,m]),d.useEffect(()=>{p()},[C,b]),d.useEffect(()=>{v.bus.on(u,{name:"pushCatalog",callback(){v.bus.emit(u,"catalogChanged",g.current)}})},[]),{html:C}},Dn=Rn,ve=e=>{const{editorId:n,previewTheme:s,showCodeRowNumber:t}=d.useContext(P),{html:l}=Dn(e,!!e.previewOnly);return pn(e,l),gn(e,l),a.jsxs(a.Fragment,{children:[a.jsx("div",{id:`${n}-preview-wrapper`,className:`${r.prefix}-preview-wrapper`,"data-show":e.setting.preview,children:a.jsx("article",{id:`${n}-preview`,className:v.classnames([`${r.prefix}-preview`,`${s}-theme`,t&&`${r.prefix}-scrn`]),dangerouslySetInnerHTML:{__html:l}})},"content-preview-wrapper"),!e.previewOnly&&a.jsx("div",{id:`${n}-html-wrapper`,className:`${r.prefix}-preview-wrapper`,"data-show":e.setting.htmlPreview,children:a.jsx("div",{className:`${r.prefix}-html`,children:l})},"html-preview-wrapper")]})};ve.defaultProps={previewOnly:!1};const On=e=>{const[n,s]=d.useState(""),{inputWrapperRef:t,codeMirrorUt:l}=mn(e);return Nr(e,n,l),a.jsxs("div",{className:`${r.prefix}-content`,children:[a.jsx("div",{className:`${r.prefix}-input-wrapper`,ref:t}),a.jsx(ve,{value:e.value,setting:e.setting,onHtmlChanged:i=>{s(i),e.onHtmlChanged(i)},onGetCatalog:e.onGetCatalog,mdHeadingId:e.mdHeadingId,noMermaid:e.noMermaid,sanitize:e.sanitize,noKatex:e.noKatex,formatCopiedText:e.formatCopiedText,noHighlight:e.noHighlight},"display-editor")]})},Fn=d.memo(On),_n=({modelValue:e})=>{const{usedLanguageText:n}=d.useContext(P);return d.useMemo(()=>{var s;return a.jsxs("div",{className:`${r.prefix}-footer-item`,children:[a.jsx("label",{className:`${r.prefix}-footer-label`,children:`${(s=n.footer)==null?void 0:s.markdownTotal}:`}),a.jsx("span",{children:e.length||0})]})},[n,e])},qn=e=>a.jsx("div",{className:v.classnames([`${r.prefix}-checkbox`,e.checked&&`${r.prefix}-checkbox-checked`]),onClick:()=>{e.onChange(!e.checked)}}),Vn=e=>{var s;const{usedLanguageText:n}=d.useContext(P);return d.useMemo(()=>{var t;return a.jsxs("div",{className:`${r.prefix}-footer-item`,children:[a.jsx("label",{className:`${r.prefix}-footer-label`,onClick:()=>{e.onScrollAutoChange(!e.scrollAuto)},children:(t=n.footer)==null?void 0:t.scrollAuto}),a.jsx(qn,{checked:e.scrollAuto,onChange:e.onScrollAutoChange})]})},[(s=n.footer)==null?void 0:s.scrollAuto,e])},Bn=e=>{const n=d.useCallback(l=>{if(r.allFooter.includes(l))switch(l){case"markdownTotal":return a.jsx(_n,{modelValue:e.modelValue},"markdown-total");case"scrollSwitch":return a.jsx(Vn,{scrollAuto:e.scrollAuto,onScrollAutoChange:e.onScrollAutoChange},"scroll-auto")}else return e.defFooters[l]||""},[e.modelValue,e.scrollAuto,e.onScrollAutoChange,e.defFooters]),[s,t]=d.useMemo(()=>{const l=e.footers.indexOf("="),i=l===-1?e.footers:e.footers.slice(0,l),u=l===-1?[]:e.footers.slice(l,Number.MAX_SAFE_INTEGER);return[i.map(o=>n(o)),u.map(o=>n(o))]},[e.footers,n]);return a.jsxs("div",{className:`${r.prefix}-footer`,children:[a.jsx("div",{className:`${r.prefix}-footer-left`,children:s}),a.jsx("div",{className:`${r.prefix}-footer-right`,children:t})]})},Un=d.memo(Bn),P=d.createContext({editorId:"",tabWidth:2,theme:"light",highlight:{css:"",js:""},showCodeRowNumber:!1,usedLanguageText:r.staticTextDefault["zh-CN"],previewTheme:"default"}),Kn=d.forwardRef((e,n)=>{const{modelValue:s=r.defaultProps.modelValue,theme:t=r.defaultProps.theme,className:l=r.defaultProps.className,toolbars:i=r.defaultProps.toolbars,toolbarsExclude:u=r.defaultProps.toolbarsExclude,defToolbars:o=r.defaultProps.defToolbars,editorId:m=r.defaultProps.editorId,tabWidth:g=r.defaultProps.tabWidth,showCodeRowNumber:c=r.defaultProps.showCodeRowNumber,previewTheme:f=r.defaultProps.previewTheme,noPrettier:w=r.defaultProps.noPrettier,tableShape:$=r.defaultProps.tableShape,noMermaid:k=r.defaultProps.noMermaid,noKatex:b=r.defaultProps.noKatex,placeholder:p=r.defaultProps.placeholder,onChange:x=r.defaultProps.onChange,onHtmlChanged:C=r.defaultProps.onHtmlChanged,onGetCatalog:y=r.defaultProps.onGetCatalog,sanitize:S=r.defaultProps.sanitize,onError:j=r.defaultProps.onError,mdHeadingId:T=r.defaultProps.mdHeadingId,footers:N=r.defaultProps.footers,defFooters:H=r.defaultProps.defFooters,noIconfont:L=r.defaultProps.noIconfont,noUploadImg:D=r.defaultProps.noUploadImg,noHighlight:O=r.defaultProps.noHighlight}=e,[E]=d.useState(()=>({editorId:m,noKatex:b,noMermaid:k,noPrettier:w,noUploadImg:D,noIconfont:L,noHighlight:O})),[G,U]=d.useState(()=>({scrollAuto:e.scrollAuto===void 0?!0:e.scrollAuto})),re=d.useCallback(F=>{U(_=>({..._,scrollAuto:F}))},[U]);or(e,E),ir(E),ar(e,E),sr(E.editorId,j);const Y=cr(e,E),[J,z,K,W]=zt(e);return dr(n,E,Y,K,W),d.useEffect(()=>()=>{v.bus.clear(m)},[]),a.jsx(P.Provider,{value:{editorId:E.editorId,tabWidth:g,theme:t,highlight:J,showCodeRowNumber:c,usedLanguageText:z,previewTheme:f},children:a.jsxs("div",{id:E.editorId,className:v.classnames([r.prefix,l,t==="dark"&&`${r.prefix}-dark`,K.fullscreen||K.pageFullscreen?`${r.prefix}-fullscreen`:""]),style:e.style,children:[a.jsx(Tr,{noPrettier:E.noPrettier,toolbars:i,toolbarsExclude:u,setting:K,updateSetting:W,tableShape:$,defToolbars:o,noUploadImg:E.noUploadImg}),a.jsx(Fn,{value:s,onChange:x,setting:K,mdHeadingId:T,onHtmlChanged:C,onGetCatalog:y,sanitize:S,noMermaid:E.noMermaid,noPrettier:E.noPrettier,noHighlight:E.noHighlight,placeholder:p,noKatex:E.noKatex,scrollAuto:G.scrollAuto,formatCopiedText:e.formatCopiedText,autoFocus:e.autoFocus,disabled:e.disabled,readOnly:e.readOnly,maxLength:e.maxLength,autoDetectCode:e.autoDetectCode,onBlur:e.onBlur,onFocus:e.onFocus,completions:e.completions}),(N==null?void 0:N.length)>0&&a.jsx(Un,{modelValue:s,footers:N,defFooters:H,scrollAuto:G.scrollAuto,onScrollAutoChange:re}),Y&&a.jsx(v.MdCatalog,{theme:t,className:`${r.prefix}-catalog-editor`,editorId:E.editorId,mdHeadingId:T},"internal-catalog")]})})}),Gn=Kn;exports.ContentPreview=ve;exports.DropDown=te;exports.Editor=Gn;exports.EditorContext=P;exports.useConfig=zt;exports.useExpansionPreview=Gt;
