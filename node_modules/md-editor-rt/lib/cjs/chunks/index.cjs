"use strict";var S=Object.defineProperty;var L=(s,e,t)=>e in s?S(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var N=(s,e,t)=>(L(s,typeof e!="symbol"?e+"":e,t),t);const x=require("./jsx-runtime.cjs"),m=require("react"),M=require("@vavt/util"),w=require("./config.cjs");class q{constructor(){N(this,"pools",{})}remove(e,t,n){const o=this.pools[e]&&this.pools[e][t];o&&(this.pools[e][t]=o.filter(c=>c!==n))}clear(e){this.pools[e]={}}on(e,t){return this.pools[e]||(this.pools[e]={}),this.pools[e][t.name]||(this.pools[e][t.name]=[]),this.pools[e][t.name].push(t.callback),this.pools[e][t.name].includes(t.callback)}emit(e,t,...n){this.pools[e]||(this.pools[e]={});const o=this.pools[e][t];o&&o.forEach(c=>{try{c(...n)}catch(a){console.error(`${t} monitor event exception！`,a)}})}}const T=new q,A=(s,e="image.png")=>{const t=s.split(","),n=t[0].match(/:(.*?);/);if(n){const r=n[1],o=atob(t[1]);let c=o.length;const a=new Uint8Array(c);for(;c--;)a[c]=o.charCodeAt(c);return new File([a],e,{type:r})}return null},B=s=>{if(!s)return s;const e=s.split(`
`),t=['<span rn-wrapper aria-hidden="true">'];return e.forEach(()=>{t.push("<span></span>")}),t.push("</span>"),`<span class="code-block">${s}</span>${t.join("")}`},j=s=>s.filter(e=>e!==!1).join(" "),F=(s,e)=>{const t=s==null?void 0:s.getBoundingClientRect();if(e===document.documentElement)return t.top-e.clientTop;const n=e==null?void 0:e.getBoundingClientRect();return t.top-n.top},P=()=>`${Date.now().toString(36)}${Math.random().toString(36).substring(2)}`,y=({tocItem:s,mdHeadingId:e,scrollElement:t,onClick:n,scrollElementOffsetTop:r=0})=>x.jsxs("div",{className:j([`${w.prefix}-catalog-link`,s.active&&`${w.prefix}-catalog-active`]),onClick:o=>{n&&n(o,s),o.stopPropagation();const c=e(s.text,s.level,s.index),a=document.getElementById(c),d=t instanceof Element?t:document.querySelector(t);if(a&&d){let i=a.offsetParent,f=a.offsetTop;if(d.contains(i))for(;i&&d!=i;)f+=i==null?void 0:i.offsetTop,i=i==null?void 0:i.offsetParent;d==null||d.scrollTo({top:f-r,behavior:"smooth"})}},children:[x.jsx("span",{title:s.text,children:s.text}),x.jsx("div",{className:`${w.prefix}-catalog-wrapper`,children:s.children&&s.children.map(o=>x.jsx(y,{mdHeadingId:e,tocItem:o,scrollElement:t,onClick:n,scrollElementOffsetTop:r},o.text))})]}),I=y,_=s=>{const{editorId:e,mdHeadingId:t=w.defaultProps.mdHeadingId,theme:n="light",offsetTop:r=20}=s,[o,c]=m.useState([]),[a,d]=m.useState(),i=m.useMemo(()=>{const l=[];return o.forEach((b,p)=>{const{text:R,level:g}=b,h={level:g,text:R,index:p+1,active:a===b};if(l.length===0)l.push(h);else{let u=l[l.length-1];if(h.level>u.level)for(let v=u.level+1;v<=6;v++){const{children:E}=u;if(!E){u.children=[h];break}if(u=E[E.length-1],h.level<=u.level){E.push(h);break}}else l.push(h)}}),l},[a,o]),[f]=m.useState(()=>s.scrollElement||`#${e}-preview-wrapper`),$=m.useCallback(()=>f instanceof HTMLElement?f:document.querySelector(f),[f]);return m.useEffect(()=>{const l=M.throttle(g=>{if(g.length===0)return c([]),!1;const{activeHead:h}=g.reduce((u,v,E)=>{const C=document.getElementById(t(v.text,v.level,E+1));if(C instanceof HTMLElement){const H=$(),k=F(C,H);if(k<r&&k>u.minTop)return{activeHead:v,minTop:k}}return u},{activeHead:g[0],minTop:Number.MIN_SAFE_INTEGER});d(h),c(g)});T.on(e,{name:"catalogChanged",callback:l});const b=$(),p=b===document.documentElement?window:b;T.emit(e,"pushCatalog");const R=()=>{l(o)};return p==null||p.addEventListener("scroll",R),()=>{T.remove(e,"catalogChanged",l),p==null||p.removeEventListener("scroll",R)}},[r,o,t,$]),x.jsx("div",{className:`${w.prefix}-catalog${n==="dark"?"-dark":""} ${s.className||""} `,style:s.style,children:i.map(l=>x.jsx(I,{mdHeadingId:t,tocItem:l,scrollElement:f,onClick:s.onClick,scrollElementOffsetTop:s.scrollElementOffsetTop},l.text))})},G=m.memo(_);exports.MdCatalog=G;exports.base642File=A;exports.bus=T;exports.classnames=j;exports.generateCodeRowNumber=B;exports.uuid=P;
